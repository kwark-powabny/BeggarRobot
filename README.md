<p></p><p><b><span style="font-size: small;"><span style="font-family: verdana;">Komunikacja szeregowa przez USB</span></span></b></p><p><span style="font-size: small;"><span style="font-family: verdana;"><br />Do połączenia z Arduino jest konieczne, by urządzenie Android obsługiwało tryb </span></span><span style="font-size: small;"><span style="font-family: verdana;"><b><span style="font-size: small;"><span style="font-family: verdana;">USB On-The-Go (OTG)</span></span></b>. Jest</span></span><span style="font-size: small;"><span style="font-family: verdana;"> to funkcja, która 
umożliwia podłączenie urządzenia z akcesoriami takimi jak klawiatura, 
mysz lub np. z dyskiem zewnętrznym. Na szczęście użyty przeze mnie tablet Kiano SlimTab 10 3GR ma taką możliwość. <span style="background-color: #fcff01;"></span><br /></span></span><br /><span style="font-size: small;"><span style="font-family: verdana;"><span style="font-size: small;"><span style="font-family: verdana;">Do komunikacji z Arduino i wykorzystania trybu OTG potrzebny jest również 
odpowiedniego kabel-adapter, który ma z jednej strony złącze <b>USB-A żeńskie</b>. Natomiast z drugiej strony potrzebne jest złącze odpowiednie dla modelu używanego urządzenia Android. W moim przypadku jest to <b>microUSB-B męskie</b>: <br /></span></span></span></span></p><p><span style="background-color: #fcff01;"><span style="font-size: small;"><span style="font-family: verdana;">&nbsp;zdjęcie</span></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;">Do tego kabla przyłącza się przewód standardowo wykorzystywany przez Arduino UNO, czyli z jednej strony <b>USB-A męskie</b> a z drugiej strony <b>USB-B męskie</b>. Takie przewody są wciąż używane do podłączania drukarki do komputera.<br /></span></span></p><p><span style="background-color: #fcff01;"><span style="font-size: small;"><span style="font-family: verdana;">zdjęcie</span></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"><br /></span></span></p><p><b><span style="font-size: small;"><span style="font-family: verdana;">Połączenie Arduino UNO z silnikami DC<br /></span></span></b></p><p><span style="font-size: small;"><span style="font-family: verdana;"><span style="background-color: #fcff01;"><span style="background-color: white;">Dłonie robota są poruszane za pomocą silniczków DC. Każdy silnik pochodzi oczywiście ze starego sprzętu - z mechanizmu drukarki atramentowej do przesuwania głowicy z atramentem.</span></span></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"><span style="background-color: #fcff01;"><span style="background-color: white;">Każdy silnik pochodzi z innej drukarki. Zatem każdy ma inne parametry. Udało mi się ustalić, że jeden z nich jest przystosowany do napięcia pracy 12V. Parametrów drugiego z silników nie udało mi się odczytać. Natomiast doświadczalnie sprawdziłem, że przy napięciu 12V również działa z rozsądną prędkością i mocą.&nbsp;</span></span></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"><span style="background-color: #fcff01;"><span style="background-color: white;">Arduino nie jest w stanie bezpośrednio zasilić silników. Jego wyjścia nie mają wystarczającego napięcia ani wydajności prądowej. Układ Arduino może jedynie dostarczyć sygnałów dla specjalnego układu będącego sterownikiem silników DC. W swoim robocie wykorzystałem jako sterownik silników DC popularny układ L293D. Napięcie zasilające silniki Vcc ustaliłem na 12V.<br /></span></span></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"><span style="background-color: #fcff01;"><span style="background-color: white;">Silniki są sterowane za pomocą modulacji PWM. Jak już napisałem, silniki różnią się od siebie, mają różne parametry. Poza tym, silniki pracują w osi pionowej - czyli raz podnoszą dłoń a innym razem ją opuszczają. </span></span></span></span><span style="font-size: small;"><span style="font-family: verdana;"><span style="background-color: #fcff01;"><span style="background-color: white;"><span style="font-size: small;"><span style="font-family: verdana;"><span style="background-color: #fcff01;"><span style="background-color: white;">W efekcie tego mają różne zapotrzebowanie na prąd. Dlatego konieczne jest dobranie parametrów PWM indywidualnie dla każdego silnika oraz dla każdej z sytuacji: ciągnięcie dłoni robota w górę lub opuszczanie jej na dół.&nbsp;</span></span></span></span></span></span></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"><span style="background-color: #fcff01;"><span style="background-color: white;"><span style="font-size: small;"><span style="font-family: verdana;"><span style="background-color: #fcff01;"><span style="background-color: white;">Do narysowania schematu elektronicznego całości wykorzystałem aplikację <a href="https://www.tinycad.net" target="_blank">TinyCAD</a> na licencji GNU LGPL v<span> 2.1. </span>Zaprojektowany przeze mnie schemat sterowania silnikami z Arduino UNO wygląda tak: <br /></span></span></span></span></span></span></span></span></p><p></p><p><span style="font-size: small;"><span style="font-family: verdana;">&nbsp;</span></span><a href="https://1.bp.blogspot.com/-LX_-JJQMemQ/YJEBO1FLb6I/AAAAAAAADow/LLxeRoRu-UcWoXBgL4sCduL9fyq7QRFywCNcBGAsYHQ/s1141/schemat.jpg" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="586" data-original-width="1141" height="328" src="https://1.bp.blogspot.com/-LX_-JJQMemQ/YJEBO1FLb6I/AAAAAAAADow/LLxeRoRu-UcWoXBgL4sCduL9fyq7QRFywCNcBGAsYHQ/w640-h328/schemat.jpg" width="640" /></a></p><p><span style="font-size: small;"><span style="font-family: verdana;"></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;"><br /><b>Program po stronie hosta Android</b><br />&nbsp;</span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;">Ku swojemu zaskoczeniu, nie znalazłem żadnej standardowej biblioteki systemu Android do obsługi transmisji szeregowej przez port USB. Zawsze wydawało mi się że to jest jedna z podstawowych możliwości komunikacji... Cóż, nie pozostało mi nic innego jak poszukać rady na forach internetowych. Większość znalezionych postów proponowała projekt <a href="https://github.com/felHR85/UsbSerial" target="_blank">Felipe Herranz - felHR85</a>. Zdecydowałem się na to rozwiązanie i nie żałuję. Implementacja <a href="https://github.com/felHR85/UsbSerial/tree/master/example" target="_blank">podanego przykładu</a> nie nie była trudna a całość zaczęła działać&nbsp; bez specjalnego grzebania w kodzie. Pojawił się tylko jeden problem. Otóż, pomimo tego że zastosowałem się do instrukcji, czyli dopisaniu do odpowiednich plików:<br /></span></span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"></p><br /><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Arial; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">build.gradle (Project level):</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: #2b2b2b; color: #a9b7c6; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">maven { url </span><span style="background-color: #2b2b2b; color: #6a8759; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">"https://jitpack.io" </span><span style="background-color: #2b2b2b; color: #a9b7c6; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">}</span></p><br /><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Arial; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">build.gradle (App level):</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: #2b2b2b; color: #a9b7c6; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">implementation </span><span style="background-color: #2b2b2b; color: #6a8759; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">'com.github.felHR85:UsbSerial:6.1.0'</span></p><br /><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Arial; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">Manifest.xml</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: #2b2b2b; color: #e8bf6a; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">&lt;uses-feature </span><span style="background-color: #2b2b2b; color: #9876aa; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">android</span><span style="background-color: #2b2b2b; color: #bababa; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">:name</span><span style="background-color: #2b2b2b; color: #6a8759; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">="android.hardware.usb.host"</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: #2b2b2b; color: #6a8759; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">&nbsp;&nbsp;&nbsp;</span><span style="background-color: #2b2b2b; color: #9876aa; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">android</span><span style="background-color: #2b2b2b; color: #bababa; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">:required</span><span style="background-color: #2b2b2b; color: #6a8759; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">="true"</span><span style="background-color: #2b2b2b; color: #e8bf6a; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">/&gt;</span></p><p><span style="font-size: small;"><span style="font-family: verdana;"></span></span></p><p><span style="background-color: transparent; color: black; font-family: Arial; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;"><span style="font-size: small;"><span style="font-family: verdana;"><span style="font-size: small;"><span style="font-family: verdana;">pojawiał się błąd:&nbsp;</span></span></span></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;">"Invoke-customs are only supported starting with Android O (--min-api 26)".&nbsp;</span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;">Na szczęście szybko udało mi się go rozwiązać przez dodanie do&nbsp; pliku</span></span><span style="background-color: transparent; color: black; font-family: Arial; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;"><span style="font-size: small;"><span style="font-family: verdana;">&nbsp;</span></span></span><span style="background-color: transparent; color: black; font-family: Arial; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre;">build.gradle (App level) </span><span style="font-size: small;"><span style="font-family: verdana;">fragmentu:</span></span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: #2b2b2b; color: #a9b7c6; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">compileOptions {</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: #2b2b2b; color: #a9b7c6; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">&nbsp;&nbsp;&nbsp;sourceCompatibility JavaVersion.</span><span style="background-color: #2b2b2b; color: #9876aa; font-family: 'Courier New'; font-size: 11pt; font-style: italic; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">VERSION_1_8</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: #2b2b2b; color: #9876aa; font-family: 'Courier New'; font-size: 11pt; font-style: italic; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">&nbsp;&nbsp;&nbsp;</span><span style="background-color: #2b2b2b; color: #a9b7c6; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">targetCompatibility JavaVersion.</span><span style="background-color: #2b2b2b; color: #9876aa; font-family: 'Courier New'; font-size: 11pt; font-style: italic; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">VERSION_1_8</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: #2b2b2b; color: #a9b7c6; font-family: 'Courier New'; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre;">}</span></p><p><span style="font-size: small;"><span style="font-family: verdana;"></span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;">Przerobienie przykładu i dostosowanie do moich potrzeb również nie było trudne.</span></span></p><p><span style="font-size: small;"><span style="font-family: verdana;">&nbsp;</span></span></p><p><b><span style="font-size: small;"><span style="font-family: verdana;">Program po stronie Arduino UNO</span></span></b></p><p><span style="font-size: small;"><span style="font-family: verdana;"></span></span></p><p><span style="font-family: verdana;">Program po stronie Arduino ma za zadanie nasłuchiwać na porcie szeregowym. Gdy przyjdą jakieś dane, próbuje je zinterpretować jako komendy dla silników (a w przyszłości również dla innych elementów robota). Następnie program uruchamia wszystkie otrzymane komendy. Zwrotnie zwraca do portu szeregowego informacje o bieżącym stanie, np. czy komenda jeszcze trwa czy już się zakończyła. Jest to przydatne przy testowaniu całości.&nbsp; <br /></span></p><p><span style="font-family: verdana;"><span style="font-family: verdana;">Do programowania używam standardowego środowiska Arduino Genuino IDE w wersji 1.8.13. Jako że preferuję programowanie obiektowe, </span></span><span style="font-family: verdana;"><span style="font-family: verdana;"><span style="font-family: verdana;"><span style="font-family: verdana;">wykorzystuję elementy języka C++. Na swoje potrzeby </span></span>zrobiłem np. klasę 
"Silnik" aby każdy silnik w programie był reprezentowany i obsługiwany 
jako oddzielny obiekt.</span> <br /></span></p><p><span style="font-family: verdana;">Arduino to stosunkowo prosty układ. Nie ma tu systemu operacyjnego. Nie ma wielowątkowości. A przydałoby się do moich potrzeb, bo przecież robot musi robić wiele rzeczy na raz - np. niezależnie podnosić każdą dłoń.&nbsp;</span></p><p><span style="font-family: verdana;">Skoro Arduino nie oferuje wielowątkowości, musiałem zrobić ją sobie sam. Moje rozwiązanie działa zadowalająco. Komendy z portu szeregowego przychodzą w jednej paczce, a mój program rozdziela je i kieruje do danego silnika. Komendy wykonują się równolegle, silniki startują i zatrzymują się w odpowiednim momencie, niezależnie od siebie.</span></p><p><span style="font-family: verdana;"><br /></span></p><p><span style="font-family: verdana;"><br /></span></p><p><span style="font-family: verdana;"><br /></span></p><p><br /></p>
